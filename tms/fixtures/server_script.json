[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2023-07-21 23:49:00.077663",
  "module": null,
  "name": "address-in-line-address-before-save",
  "reference_doctype": "Address",
  "script": "# if frappe.db.exists({\"doctype\": \"TMS Customer\", \"address_title\": doc.address_title, \"company\": doc.company}):\n#     list = frappe.db.get_list('TMS Customer',\n#     filters={\n#         \"address_title\": doc.address_title, \n#         \"company\": doc.company\n#     },\n#     fields=['name'],\n#     order_by='creation desc',\n#     )\n#     if list[0].name not in doc.name:\n#         frappe.throw(f\"{doc.address_title} is already in {doc.company}'s Sender\")\n\nif \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\" in doc.state:\n    city_prefix = '\u0e41\u0e02\u0e27\u0e07'\n    county_prefix = '\u0e40\u0e02\u0e15'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\u0e2f \") if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode\nelse:\n    city_prefix = '\u0e15\u0e33\u0e1a\u0e25'\n    county_prefix = '\u0e2d\u0e33\u0e40\u0e20\u0e2d'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + doc.state + ' ') if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-07-21 23:46:59.063721",
  "module": null,
  "name": "address-in-line-address",
  "reference_doctype": "Address",
  "script": "if \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\" in doc.state:\n    city_prefix = '\u0e41\u0e02\u0e27\u0e07'\n    county_prefix = '\u0e40\u0e02\u0e15'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\u0e2f \") if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode\nelse:\n    city_prefix = '\u0e15\u0e33\u0e1a\u0e25'\n    county_prefix = '\u0e2d\u0e33\u0e40\u0e20\u0e2d'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + doc.state + ' ') if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-05-31 01:58:28.088117",
  "module": null,
  "name": "tms-customer-in-line-address",
  "reference_doctype": "TMS Customer",
  "script": "if \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\" in doc.state:\n    city_prefix = '\u0e41\u0e02\u0e27\u0e07'\n    county_prefix = '\u0e40\u0e02\u0e15'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\u0e2f \") if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode\nelse:\n    city_prefix = '\u0e15\u0e33\u0e1a\u0e25'\n    county_prefix = '\u0e2d\u0e33\u0e40\u0e20\u0e2d'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + doc.state + ' ') if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2023-06-20 08:16:04.786490",
  "module": null,
  "name": "tms-customer-in-line-address-before-save",
  "reference_doctype": "TMS Customer",
  "script": "# if frappe.db.exists({\"doctype\": \"TMS Customer\", \"address_title\": doc.address_title, \"company\": doc.company}):\n#     list = frappe.db.get_list('TMS Customer',\n#     filters={\n#         \"address_title\": doc.address_title, \n#         \"company\": doc.company\n#     },\n#     fields=['name'],\n#     order_by='creation desc',\n#     )\n#     if list[0].name not in doc.name:\n#         frappe.throw(f\"{doc.address_title} is already in {doc.company}'s Sender\")\n\nif \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\" in doc.state:\n    city_prefix = '\u0e41\u0e02\u0e27\u0e07'\n    county_prefix = '\u0e40\u0e02\u0e15'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\u0e2f \") if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode\nelse:\n    city_prefix = '\u0e15\u0e33\u0e1a\u0e25'\n    county_prefix = '\u0e2d\u0e33\u0e40\u0e20\u0e2d'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + doc.state + ' ') if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "create-sending-money",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-07-03 18:25:02.832704",
  "module": null,
  "name": "create-sending-money",
  "reference_doctype": null,
  "script": "sending_money_record = frappe.get_doc({\n        \"doctype\": \"Money Send Record\",\n        \"payment_total\": frappe.form_dict.get('payment_total'),\n        \"total_received_amount\": frappe.form_dict.get('payment_total'),\n        \"date\": frappe.form_dict.get('date'),\n        \"items\":json.loads(frappe.form_dict.get('items')),\n        \n    })\nsending_money_record.insert(ignore_permissions=True)\n# sending_money_record.submit()\n\nfrappe.response['message'] = sending_money_record.name",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2023-06-13 15:14:36.292752",
  "module": null,
  "name": "money-send-before-save",
  "reference_doctype": "Money Send Record",
  "script": "total_received_amount = 0\nfor record in doc.items: \n    if record.received_amount > record.remaining_amount:\n        frappe.throw(\n    title='Error',\n    msg='Cannot Send Money More Than Remaining Amount',\n)\n    total_received_amount = total_received_amount + record.received_amount\n\nfrappe.db.set_value('Money Send Record', doc.name, 'total_received_amount', total_received_amount, update_modified=False)\nfrappe.db.set_value('Money Send Record', doc.name, 'payment_total', total_received_amount, update_modified=False)",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-09-14 02:27:26.626767",
  "module": null,
  "name": "money-send-after-submit",
  "reference_doctype": "Money Send Record",
  "script": "total_received_amount = 0\nfor item in doc.items:\n    if item.delivery_order is not None:\n        grand_total = frappe.db.get_value('Delivery Order', item.delivery_order, 'grand_total')\n        comission = frappe.db.get_value('Delivery Order', item.delivery_order, 'commission')\n        money_received_amount = frappe.db.get_value('Delivery Order', item.delivery_order, 'money_received_amount')\n        new_total = money_received_amount + item.received_amount\n        total_received_amount = total_received_amount + item.received_amount\n        # note = frappe.get_doc('Delivery Order', item.delivery_order)\n        # note.received_amount = item.received_amount\n        # note.save(ignore_permissions=True)\n        frappe.db.set_value('Delivery Order', item.delivery_order, 'money_received_amount', new_total)\n        if(new_total == (grand_total - comission)):\n            frappe.db.set_value('Delivery Order', item.delivery_order, 'sending_money_status', 'Close')\n        else:\n            frappe.db.set_value('Delivery Order', item.delivery_order, 'sending_money_status', 'Open')\n        # frappe.db.set_value('Delivery Order', item.delivery_order, 'remaining_amount', float(grand_total) - float(item.recieved_amount))\nfrappe.db.set_value('Money Send Record', doc.name, 'total_received_amount', total_received_amount, update_modified=False)\nfrappe.db.set_value('Money Send Record', doc.name, 'payment_total', doc.total_received_amount)\nif total_received_amount > 0:\n    frappe.db.set_value('Money Send Record', doc.name, 'status', 'To Bill')\nelse:\n    frappe.db.set_value('Money Send Record', doc.name, 'status', 'Billed')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Cancel",
  "event_frequency": "All",
  "modified": "2023-09-13 14:38:40.166886",
  "module": null,
  "name": "money-send-after-cancel",
  "reference_doctype": "Money Send Record",
  "script": "for item in doc.items:\n    if item.delivery_order is not None:\n        commission = frappe.db.get_value('Delivery Order', item.delivery_order, 'commission')\n        grand_total = frappe.db.get_value('Delivery Order', item.delivery_order, 'grand_total')\n        money_received_amount = frappe.db.get_value('Delivery Order', item.delivery_order, 'money_received_amount')\n        new_total = money_received_amount - item.received_amount\n        # note = frappe.get_doc('Delivery Order', item.delivery_order)\n        # note.received_amount = item.received_amount\n        # note.save(ignore_permissions=True)\n        frappe.db.set_value('Delivery Order', item.delivery_order, 'money_received_amount', new_total)\n        if(new_total == (grand_total - commission) and grand_total != 0):\n            frappe.db.set_value('Delivery Order', item.delivery_order, 'sending_money_status', 'Close')\n        else:\n            frappe.db.set_value('Delivery Order', item.delivery_order, 'sending_money_status', 'Open')\n        \nfrappe.db.set_value('Money Send Record', doc.name, 'status', 'Cancelled')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "edit-delivery-order-items",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-09-13 03:17:28.830793",
  "module": null,
  "name": "edit-delivery-order-items",
  "reference_doctype": null,
  "script": "note = frappe.get_doc('Delivery Order', frappe.form_dict.get('delivery_order'))\ndoc = frappe.get_doc('Delivery Order', frappe.form_dict.get('delivery_order'))\nitems = json.loads(frappe.form_dict.get('items'))\n\nresponse = 'ok'\n\nfor item in items:\n    frappe.db.set_value('Delivery Order Item', item.get('name'), {\n        \"item_code\": item.get('item_code'),\n        \"item_name\": item.get('item_name'),\n        \"qty\": item.get('qty'),\n        \"uom\": item.get('uom'),\n        \"rate\": item.get('rate'),\n        \"amount\": float(item.get('qty')) * float(item.get('rate')),\n    })\n\ntotal_sum = sum(float(item.get('amount')) for item in items)\nfrappe.db.set_value('Delivery Order', note.get('name'), {\n        \"total_qty\": sum(float(item.get('qty')) for item in items),\n        \"grand_total\": total_sum,\n        \"sending_money_status\": 'Close' if float(total_sum) == float(doc.money_received_amount) else 'Open'\n    })\nfrappe.db.commit()\n\n# save rate\nfor child in items:\n    filter_options = {\n\t            \"sender_id\": doc.sender_id,\n\t            \"recipient_id\": doc.recipient_id,\n\t            \"cash_on\": doc.cash_on,\n\t            \"item\": child.get('item_code'),\n\t            \"uom\": child.get('uom'),\n\t}\n    if float(child.get('rate')) != 0:\n        new_doc = frappe.get_doc({\n                'doctype': 'TMS Price List',\n\t            'sender_id': doc.sender_id,\n\t            'recipient_id': doc.recipient_id,\n\t            'cash_on': doc.cash_on,\n\t            'item': child.get('item_code'),\n\t            'uom': child.get('uom'),\n\t            'rate': child.get('rate')\n\t        })\n        if(frappe.db.exists(\"TMS Price List\", filter_options) is None):\n            if(child.get('item_code') is not None):\n                new_doc.insert()\n                response = \"Rate Save !\"\n        else:\n            exist = frappe.db.get_all('TMS Price List', filters=filter_options)\n            frappe.db.set_value('TMS Price List', exist[0].get('name'), 'rate', child.get('rate'))\n            response = 'Save Price List To ' + frappe.db.exists(\"TMS Price List\", filter_options)\n    frappe.db.commit()\n\nfrappe.response['message'] = response",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-09-14 13:11:20.765088",
  "module": null,
  "name": "delivery-order-transfer-after-submit",
  "reference_doctype": "Delivery Order Transfer",
  "script": "error_do_in = []\nerror_do_warehouse = []\nerror_do_trip = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.transfer_status != 'Open':\n        if do.tr_no != doc.name:\n            error_do_in.append(do.name)\n    if do.current_warehouse != doc.source_warehouse:\n        error_do_warehouse.append(do.name)\n    if do.dr_no != None:\n            error_do_trip.append(do.name)\n\nif len(error_do_in) > 0:\n    frappe.throw('Delivery Order Is '+ do.transfer_status + ': '  + ','.join(error_do_in))\nif len(error_do_warehouse) > 0:\n    frappe.throw('Delivery Order Is Not Currently In ' + doc.source_warehouse + ': ' + ','.join(error_do_warehouse))\nif len(error_do_trip) > 0:\n    frappe.throw('Delivery Order Is Already Dispatch: ' + ','.join(error_do_trip))\n\nif doc.transporter is not None and doc.payment_total > 0:\n    frappe.db.set_value('Delivery Order Transfer', doc.name, {\n        'status': 'To Bill'\n    })\nelse:\n    frappe.db.set_value('Delivery Order Transfer', doc.name, {\n        'status': 'Billed',\n        'payment_total': 0\n    })\n    \nfrappe.db.set_value('Delivery Order Transfer', doc.name, {\n        'posting_date': frappe.utils.now(),\n        'posting_time': frappe.utils.now()\n    })\n\nfrappe.response['message'] = \"Updated !\"\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Cancel",
  "event_frequency": "All",
  "modified": "2023-09-14 13:10:59.796381",
  "module": null,
  "name": "delivery-order-transfer-after-cancel",
  "reference_doctype": "Delivery Order Transfer",
  "script": "error_do_in = []\nerror_do_trip = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.transfer_status != 'Open':\n        if do.tr_no != doc.name:\n            error_do_in.append(do.name)\n    if do.dr_no != None:\n            error_do_trip.append(do.name)\n\nif len(error_do_in) > 0:\n    frappe.throw('Delivery Order Is '+ do.transfer_status + ': '  + ','.join(error_do_in))\nif len(error_do_trip) > 0:\n    frappe.throw('Delivery Order Is Already Dispatch: ' + ','.join(error_do_trip))\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    records = frappe.get_all(\"Delivery Order Transfer\",\n    fields=['name', 'transfer_status', 'source_warehouse', 'target_warehouse', 'driver', 'driver_name', 'vehicle', 'departure_date_time', 'target_warehouse'],\n    filters=[\n            [\"Delivery Order Transfer Item\", \"delivery_order\", \"=\", do.name],\n            [\"docstatus\", \"!=\", 2]\n        ],\n    order_by='name desc',\n    page_length=1,\n    )\n    if len(records) > 0:\n        latest = records[0]\n        if latest.transfer_status == 'Completed':\n            frappe.db.set_value('Delivery Order', do.name, {\n                'transfer_status': 'Open',\n                'current_warehouse': latest.target_warehouse,\n                'tr_no': latest.name,\n                'transfer_driver': latest.driver,\n                'transfer_driver_name': latest.driver_name,\n                'transfer_vehicle_no': latest.vehicle,\n                'transfer_date_time': latest.departure_date_time,\n                'transfer_target_warehouse': latest.target_warehouse\n            })\n        else:\n            frappe.db.set_value('Delivery Order', latest.name, {\n                'transfer_status': latest.transfer_status,\n                'current_warehouse': latest.source_warehouse,\n                'tr_no': latest.name,\n                'transfer_driver': latest.driver,\n                'transfer_driver_name': latest.driver_name,\n                'transfer_vehicle_no': latest.vehicle,\n                'transfer_date_time': latest.departure_date_time,\n                'transfer_target_warehouse': latest.target_warehouse\n            })\n    else:\n        frappe.db.set_value('Delivery Order', do.name, {\n        'tr_no': None,\n        'transfer_driver': None,\n        'transfer_driver_name': None,\n        'transfer_vehicle_no': None,\n        'transfer_date_time': None,\n        'transfer_target_warehouse': None,\n        'current_warehouse': do.source_warehouse,\n        'transfer_status': 'Open'\n    })\n    \n    \n    \nfrappe.db.set_value('Delivery Order Transfer', doc.name, {\n        'status': 'Cancelled',\n    })\n\nfrappe.response['message'] = \"Clear !\"\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-09-14 13:15:11.083064",
  "module": null,
  "name": "delivery-order-trip-after-submit",
  "reference_doctype": "Delivery Order Trip",
  "script": "error_do_warehouse = []\nerror_do_not_open = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.current_warehouse != doc.source_warehouse:\n        error_do_warehouse.append(do.name)\n    if do.transfer_status != 'Open':\n        error_do_not_open.append(do.name)\n\nif len(error_do_warehouse) > 0:\n    frappe.throw('Delivery Order Is Not Currently In ' + doc.source_warehouse + ': ' + ','.join(error_do_warehouse))\nif len(error_do_not_open) > 0:\n    frappe.throw('Delivery Order Is Not Open For Dispatch: ' + ','.join(error_do_warehouse))\n\nitems = doc.items\nfor item in items:\n    frappe.db.set_value('Delivery Order', item.delivery_order, {\n        'dr_no': doc.name,\n        'dispatch_driver': doc.driver,\n        'dispatch_driver_name': doc.driver_name,\n        'dispatch_vehicle_no': doc.vehicle,\n        'dispatch_date_time': doc.departure_date_time\n    })\n    \nif doc.transporter is not None and doc.payment_total > 0:\n    frappe.db.set_value('Delivery Order Trip', doc.name, {\n        'status': 'To Bill'\n    })\nelse:\n    frappe.db.set_value('Delivery Order Trip', doc.name, {\n        'status': 'Billed',\n        'payment_total': 0\n    })\n\nfrappe.response['message'] = \"Updated !\"\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Cancel",
  "event_frequency": "All",
  "modified": "2023-09-13 04:15:30.832700",
  "module": null,
  "name": "delivery-order-trip-after-cancel",
  "reference_doctype": "Delivery Order Trip",
  "script": "note_have_transfer = frappe.db.get_list('Delivery Order',\n    filters={\n        'dr_no': doc.name\n    },\n    fields= ['name']\n)\n\nfor order in note_have_transfer:\n    frappe.db.set_value('Delivery Order', order.name, {\n        'dr_no': None,\n        'dispatch_driver': None,\n        'dispatch_driver_name': None,\n        'dispatch_vehicle_no': None,\n        'dispatch_date_time': None\n    })\n\nfrappe.response['message'] = \"Clear !\"\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-06-02 19:30:53.469458",
  "module": null,
  "name": "tms-bank-transaction-after-submit",
  "reference_doctype": "TMS Bank Transaction",
  "script": "cl_amount = 0\nif 'Debit' in doc.transaction_type:\n    cl_amount = doc.amount * (-1)\nelse:\n    cl_amount = doc.amount\n    \ndoc.cl_amount = cl_amount\n\ncal_amount = cl_amount\n    \nif 'Money Send Record' in doc.document_type:\n    bt_amount = frappe.db.get_value(doc.document_type, doc.document_name, 'bt_amount')\n    check_field = 'total_received_amount'\n    check_value = frappe.db.get_value(doc.document_type, doc.document_name, check_field)\n    new_bt_amount = float(bt_amount) + float(cal_amount)\n    \n    frappe.db.set_value(doc.document_type, doc.document_name, {\n        'bt_amount': new_bt_amount,\n    })\n    \n    if new_bt_amount == check_value:\n        frappe.db.set_value(doc.document_type, doc.document_name, {\n            'status': 'Paid',\n        })\n    else:\n        frappe.db.set_value(doc.document_type, doc.document_name, {\n            'status': 'Submitted',\n        })\n    \n# bt_amount = frappe.db.get_value(doc.document_type, doc.document_name, 'bt_amount')\n\n# check_field = 'grand_total'\n# if doc.document_type is 'Money Send Record':\n#     check_field = 'total_received_amount'\n    \n# new_bt_amount = bt_amount + cl_amount\n\n# frappe.db.set_value(doc.document_type, doc.document_name, {\n#         'bt_amount': cl_amount,\n#     })\n# frappe.response['message'] = cl_amount\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Cancel",
  "event_frequency": "All",
  "modified": "2023-06-02 19:32:25.812452",
  "module": null,
  "name": "tms-bank-transaction-after-cancel",
  "reference_doctype": "TMS Bank Transaction",
  "script": "cl_amount = 0\nif 'Debit' in doc.transaction_type:\n    cl_amount = doc.amount * (-1)\nelse:\n    cl_amount = doc.amount\n    \ndoc.cl_amount = cl_amount\n\ncal_amount = cl_amount * (-1)\n    \nif 'Money Send Record' in doc.document_type:\n    bt_amount = frappe.db.get_value(doc.document_type, doc.document_name, 'bt_amount')\n    check_field = 'total_received_amount'\n    check_value = frappe.db.get_value(doc.document_type, doc.document_name, check_field)\n    new_bt_amount = float(bt_amount) + float(cal_amount)\n    \n    frappe.db.set_value(doc.document_type, doc.document_name, {\n        'bt_amount': new_bt_amount,\n    })\n    \n    if float(new_bt_amount) == float(check_value):\n        frappe.db.set_value(doc.document_type, doc.document_name, {\n            'status': 'Paid',\n        })\n    else:\n        frappe.db.set_value(doc.document_type, doc.document_name, {\n            'status': 'Submitted',\n        })\n    \n# bt_amount = frappe.db.get_value(doc.document_type, doc.document_name, 'bt_amount')\n\n# check_field = 'grand_total'\n# if doc.document_type is 'Money Send Record':\n#     check_field = 'total_received_amount'\n    \n# new_bt_amount = bt_amount + cl_amount\n\n# frappe.db.set_value(doc.document_type, doc.document_name, {\n#         'bt_amount': cl_amount,\n#     })\n# frappe.response['message'] = cl_amount\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save (Submitted Document)",
  "event_frequency": "All",
  "modified": "2023-09-14 13:00:37.968762",
  "module": null,
  "name": "delivery-order-after-save",
  "reference_doctype": "Delivery Order",
  "script": "if len(doc.items) > 5:\n    frappe.throw('Delivery Order Need No More Than 5')\n\nif doc.money_received_amount == doc.grand_total - doc.commission and doc.grand_total != 0:\n    # doc.sending_money_status = 'Close'\n    frappe.db.set_value('Delivery Order', doc.name,\n                        {'sending_money_status': 'Close'}, update_modified=False\n                        )\nelse:\n    # doc.sending_money_status = 'Open'\n    frappe.db.set_value('Delivery Order', doc.name,\n                        {'sending_money_status': 'Open'}, update_modified=False\n                        )\n\n# Money Send Record\n\nmn_sends = frappe.db.get_all('Money Send Record Item',\n                              filters={'delivery_order': doc.name,\n                                  'parenttype': 'Money Send Record'},\n                              fields=['name'])\n\nfor record_name in mn_sends:\n    frappe.db.set_value('Money Send Record Item', record_name,\n                        {'recipient_name': doc.recipient})\n\n# Delivery Order Transfer\n\ndo_transfers = frappe.db.get_all('Delivery Order Transfer Item',\n                                  filters={'delivery_order': doc.name,\n                                  'parenttype': 'Delivery Order Transfer'},\n                                  fields=['name', 'posting_date','source_warehouse','sender','recipient','recipient_in_line_address','hand_bill_no','recipient_county','recipient_province','grand_total','grand_total_qty','grand_total_weight','grand_total_volume','cash_on']\n                                  )\nif len(do_transfers) > 0:\n    for record in do_transfers:\n        frappe.db.set_value('Delivery Order Transfer Item', record.name, {\n            'posting_date': doc.posting_date,\n            'source_warehouse': doc.source_warehouse,\n            'sender': doc.sender_id,\n            'recipient': doc.recipient_id,\n            'recipient_in_line_address': doc.recipient_in_line_address,\n            'hand_bill_no': doc.hand_bill_no,\n            'recipient_county': doc.recipient_county,\n            'recipient_province': doc.recipient_province,\n            'grand_total': doc.grand_total,\n            'grand_total_qty': doc.grand_total_qty,\n            'grand_total_weight': doc.grand_total_weight,\n            'grand_total_volume': doc.grand_total_volume,\n            'cash_on': doc.cash_on,\n            })\n\n# Delivery Order Trip\n\ndo_trips = frappe.db.get_all('Delivery Order Trip Item',\n                              filters={\n                                  'delivery_order': doc.name,\n                                  'parenttype': 'Delivery Order Trip'\n                              },\n                              fields=['name', 'posting_date','source_warehouse','sender','recipient','recipient_in_line_address','hand_bill_no','recipient_county','recipient_province','grand_total','grand_total_qty','grand_total_weight','grand_total_volume','cash_on']\n                              )\n\nif len(do_trips) > 0:\n    for record in do_trips:\n        frappe.db.set_value('Delivery Order Trip Item', record.name, {\n            'posting_date': doc.posting_date,\n            'source_warehouse': doc.source_warehouse,\n            'sender': doc.sender_id,\n            'recipient': doc.recipient_id,\n            'recipient_in_line_address': doc.recipient_in_line_address,\n            'hand_bill_no': doc.hand_bill_no,\n            'recipient_county': doc.recipient_county,\n            'recipient_province': doc.recipient_province,\n            'grand_total': doc.grand_total,\n            'grand_total_qty': doc.grand_total_qty,\n            'grand_total_weight': doc.grand_total_weight,\n            'grand_total_volume': doc.grand_total_volume,\n            'cash_on': doc.cash_on,\n        })\n\n# Item Price List\n\nfor child in doc.items:\n    filter_options = {\n        'sender_id': doc.sender_id,\n        'recipient_id': doc.recipient_id,\n        'cash_on': doc.cash_on,\n        'item': child.get('item_code'),\n        'uom': child.get('uom'),\n        }\n    if float(child.get('rate')) != 0 and doc.save_rate == 1:\n        new_doc = frappe.get_doc({\n            'doctype': 'TMS Price List',\n            'sender_id': doc.sender_id,\n            'recipient_id': doc.recipient_id,\n            'cash_on': doc.cash_on,\n            'item': child.get('item_code'),\n            'uom': child.get('uom'),\n            'rate': child.get('rate'),\n            })\n        list = frappe.db.get_list('TMS Price List', pluck='name',\n                                  filters=filter_options)\n        if len(list) <= 0:\n            if(child.get('item_code') is not None):\n                new_doc.insert()\n        else:\n            frappe.db.set_value('TMS Price List', list[0], 'rate',\n                                child.get('rate'))\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-09-13 04:20:11.794180",
  "module": null,
  "name": "delivery-order-after-submit",
  "reference_doctype": "Delivery Order",
  "script": "frappe.db.set_value('Delivery Order', doc.name, 'money_received_amount', 0)\nfrappe.db.set_value('Delivery Order', doc.name, 'status', 'Submitted')\n\ngrand_total = 0\ngrand_qty = 0\nfor item in doc.items:\n    grand_total = grand_total + item.amount\n    grand_qty = grand_qty + item.qty\n    \nfrappe.db.set_value('Delivery Order', doc.name,\n                        {\n                            'grand_total': grand_total,\n                            'grand_total_qty': grand_qty,\n                            'current_warehouse': doc.source_warehouse,\n                            'transfer_status': 'Open',\n                            'tr_no': None,\n                            'transfer_driver': None,\n                            'transfer_driver_name': None,\n                            'transfer_vehicle_no': None,\n                            'transfer_date_time': None,\n                            'transfer_target_warehouse': None,\n                            'dr_no': None,\n                            'dispatch_driver': None,\n                            'dispatch_driver_name': None,\n                            'dispatch_vehicle_no': None,\n                            'dispatch_date_time': None,\n                        }, update_modified=False\n                        )\n\nfor child in doc.items:\n    filter_options = {\n\t            \"sender_id\": doc.sender_id,\n\t            \"recipient_id\": doc.recipient_id,\n\t            \"cash_on\": doc.cash_on,\n\t            \"item\": child.get('item_code'),\n\t            \"uom\": child.get('uom'),\n\t}\n    if float(child.get('rate')) != 0 and doc.save_rate == 1:\n        new_doc = frappe.get_doc({\n                'doctype': 'TMS Price List',\n\t            'sender_id': doc.sender_id,\n\t            'recipient_id': doc.recipient_id,\n\t            'cash_on': doc.cash_on,\n\t            'item': child.get('item_code'),\n\t            'uom': child.get('uom'),\n\t            'rate': child.get('rate')\n\t        })\n        list = frappe.db.get_all('TMS Price List', pluck='name', filters=filter_options)\n        if(len(list) <= 0):\n            new_doc.insert()\n        else:\n            frappe.db.set_value('TMS Price List', list[0], 'rate', child.get('rate'))\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Validate",
  "event_frequency": "All",
  "modified": "2023-07-29 04:47:19.373893",
  "module": null,
  "name": "sales-invoice-before-validate",
  "reference_doctype": "Sales Invoice",
  "script": "company = frappe.get_doc('Company', doc.company)\n\nif 'Money Send Record' in doc.tms_reference_type:\n    if len(doc.items) > 0:\n        for item in doc.items:\n            item.delete()\n    doc.items = []\n    income_item = frappe.get_doc('Item', company.tms_income_item) \n    money_send_record = frappe.get_doc('Money Send Record', doc.money_send_record) \n    doc.append(\"items\", {\n        'item_code': income_item.name,\n        'item_name': income_item.item_name,\n        'rate': money_send_record.payment_total,\n        'base_rate': money_send_record.payment_total,\n        'qty': 1,\n        'ps': '-',\n        'uom': income_item.stock_uom,\n        \n    })\n    \nif 'Delivery Order' in doc.tms_reference_type:\n    if len(doc.items) > 0:\n        for item in doc.items:\n            item.delete()\n    doc.items = []\n    income_item = frappe.get_doc('Item', company.tms_income_item) \n    delivery_order = frappe.get_doc('Delivery Order', doc.delivery_order) \n    doc.append(\"items\", {\n        'item_code': income_item.name,\n        'item_name': income_item.item_name,\n        'rate': delivery_order.grand_total + (delivery_order.grand_total * (1.0101 / 100)),\n        'base_rate': delivery_order.grand_total + (delivery_order.grand_total * (1.0101 / 100)),\n        'qty': 1,\n        'ps': '-',\n        'uom': income_item.stock_uom,\n        \n    })\n    doc.additional_discount_percentage = 1.00",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-07-26 19:39:58.036668",
  "module": null,
  "name": "sales-invoice-after-submit",
  "reference_doctype": "Sales Invoice",
  "script": "# company = frappe.get_doc('Company', doc.company)\n\nif 'Money Send Record' in doc.tms_reference_type:\n    frappe.db.set_value('Money Send Record', doc.money_send_record, 'status', 'Billed')\n    \nif 'Delivery Order' in doc.tms_reference_type:\n    frappe.db.set_value('Delivery Order', doc.delivery_order, 'status', 'Billed')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Cancel",
  "event_frequency": "All",
  "modified": "2023-07-26 19:40:24.466960",
  "module": null,
  "name": "sales-invoice-after-cancelled",
  "reference_doctype": "Sales Invoice",
  "script": "# company = frappe.get_doc('Company', doc.company)\n\nif 'Money Send Record' in doc.tms_reference_type:\n    frappe.db.set_value('Money Send Record', doc.money_send_record, 'status', 'To Bill')\n    \nif 'Delivery Order' in doc.tms_reference_type:\n    frappe.db.set_value('Delivery Order', doc.delivery_order, 'status', 'To Bill')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Cancel",
  "event_frequency": "All",
  "modified": "2023-06-12 23:36:44.915030",
  "module": null,
  "name": "delivery-order-after-cancel",
  "reference_doctype": "Delivery Order",
  "script": "frappe.db.set_value('Delivery Order', doc.name, 'status', 'Cancelled')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Validate",
  "event_frequency": "All",
  "modified": "2023-06-25 23:46:56.212371",
  "module": null,
  "name": "purchase-invoice-before-validate",
  "reference_doctype": "Purchase Invoice",
  "script": "def submit(doctype, doc, field):\n    company = frappe.get_doc('Company', doc.company)\n    if len(doc.items) > 0:\n        for item in doc.items:\n            item.delete()\n    doc.items = []\n    expense_item = frappe.get_doc('Item', company.tms_expense_item) \n    ref_doc = frappe.get_doc(doctype, field) \n    doc.append(\"items\", {\n        'item_code': expense_item.name,\n        'item_name': expense_item.item_name,\n        'rate': ref_doc.payment_total,\n        'base_rate': ref_doc.payment_total,\n        'qty': 1,\n        'ps': '-',\n        'uom': expense_item.stock_uom,\n        \n    })\n\nif 'TMS Expense' in doc.tms_reference_type:\n    submit('TMS Expense', doc, doc.ref_tms_expense)\nif 'Delivery Order Trip' in doc.tms_reference_type:\n    submit('Delivery Order Trip', doc, doc.ref_delivery_order_trip)\nif 'Delivery Order Transfer' in doc.tms_reference_type:\n    submit('Delivery Order Transfer', doc, doc.ref_delivery_order_transfer)\nif 'Receipt' in doc.tms_reference_type:\n    submit('Receipt', doc, doc.ref_receipt)",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Cancel",
  "event_frequency": "All",
  "modified": "2023-06-27 12:15:21.698066",
  "module": null,
  "name": "purchase-invoice-after-cancel",
  "reference_doctype": "Purchase Invoice",
  "script": "# company = frappe.get_doc('Company', doc.company)\n\nif 'TMS Expense' in doc.tms_reference_type:\n    frappe.db.set_value('TMS Expense', doc.ref_tms_expense, 'status', 'To Bill')\nif 'Delivery Order Trip' in doc.tms_reference_type:\n    frappe.db.set_value('Delivery Order Trip', doc.ref_delivery_order_trip, 'status', 'To Bill')\nif 'Delivery Order Transfer' in doc.tms_reference_type:\n    frappe.db.set_value('Delivery Order Transfer', doc.ref_delivery_order_transfer, 'status', 'To Bill')\nif 'Receipt' in doc.tms_reference_type:\n    frappe.db.set_value('Receipt', doc.ref_receipt, 'status', 'To Bill')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-06-25 23:43:19.457192",
  "module": null,
  "name": "purchase-invoice-after-submit",
  "reference_doctype": "Purchase Invoice",
  "script": "# company = frappe.get_doc('Company', doc.company)\n\nif 'TMS Expense' in doc.tms_reference_type:\n    frappe.db.set_value('TMS Expense', doc.ref_tms_expense, 'status', 'Billed')\n    \nif 'Delivery Order Transfer' in doc.tms_reference_type:\n    frappe.db.set_value('Delivery Order Transfer', doc.ref_delivery_order_transfer, 'status', 'Billed')\n    \nif 'Delivery Order Trip' in doc.tms_reference_type:\n    frappe.db.set_value('Delivery Order Trip', doc.ref_delivery_order_trip, 'status', 'Billed')\n    \nif 'Receipt' in doc.tms_reference_type:\n    frappe.db.set_value('Receipt', doc.ref_receipt, 'status', 'Billed')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-09-14 02:28:26.196753",
  "module": null,
  "name": "tms-expense-after-submit",
  "reference_doctype": "TMS Expense",
  "script": "# doc.status = 'To Bill'\nif doc.payment_total > 0:\n    frappe.db.set_value('TMS Expense', doc.name, {\n            'status': 'To Bill'\n    })\nelse:\n    frappe.db.set_value('TMS Expense', doc.name, {\n            'status': 'Billed'\n    })",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Cancel",
  "event_frequency": "All",
  "modified": "2023-06-14 01:32:38.144132",
  "module": null,
  "name": "tms-expense-after-cancel",
  "reference_doctype": "TMS Expense",
  "script": "frappe.db.set_value('TMS Expense', doc.name, {\n        'status': 'Cancelled'\n})",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "delete-delivery-order-transfer-child",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-06-14 03:07:29.202966",
  "module": null,
  "name": "delete-delivery-order-transfer-child",
  "reference_doctype": null,
  "script": "items = json.loads(frappe.form_dict.get('items'))\n\nresponse = 'ok'\n\nfor item in items:\n    child = frappe.get_doc('Delivery Order Transfer Item', item)\n    frappe.db.set_value('Delivery Order', child.delivery_order, {\n        'tr_no': None,\n        'transfer_driver': None,\n        'transfer_driver_name': None,\n        'transfer_vehicle_no': None,\n        'transfer_date_time': None\n    })\n    child.delete(ignore_permissions=True)\n\nfrappe.response['message'] = response",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": "delete-delivery-order-trip-child",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-06-14 03:12:08.367296",
  "module": null,
  "name": "delete-delivery-order-trip-child",
  "reference_doctype": null,
  "script": "items = json.loads(frappe.form_dict.get('items'))\n\nresponse = 'ok'\n\nfor item in items:\n    child = frappe.get_doc('Delivery Order Trip Item', item)\n    frappe.db.set_value('Delivery Order', child.delivery_order, {\n        'dr_no': None,\n        'dispatch_driver': None,\n        'dispatch_driver_name': None,\n        'dispatch_vehicle_no': None,\n        'dispatch_date_time': None\n    })\n    child.cancel()\n    child.delete()\n\nfrappe.response['message'] = response",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save (Submitted Document)",
  "event_frequency": "All",
  "modified": "2023-09-14 13:11:14.064895",
  "module": null,
  "name": "delivery-order-transfer-after-save-submit",
  "reference_doctype": "Delivery Order Transfer",
  "script": "error_do_in = []\nerror_do_warehouse = []\nerror_do_trip = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.transfer_status != 'Open':\n        if do.tr_no != doc.name:\n            error_do_in.append(do.name)\n    if do.current_warehouse != doc.source_warehouse:\n        error_do_warehouse.append(do.name)\n    if do.dr_no != None:\n            error_do_trip.append(do.name)\n\nif len(error_do_in) > 0:\n    frappe.throw('Delivery Order Is '+ do.transfer_status + ': '  + ','.join(error_do_in))\nif len(error_do_warehouse) > 0:\n    frappe.throw('Delivery Order Is Not Currently In ' + doc.source_warehouse + ': ' + ','.join(error_do_warehouse))\nif len(error_do_trip) > 0:\n    frappe.throw('Delivery Order Is Already Dispatch: ' + ','.join(error_do_trip))\n            \nnote_have_transfer = frappe.db.get_list('Delivery Order',\n    filters={\n        'tr_no': doc.name\n    },\n    fields= ['name', 'tr_no'],\n    page_length=9999\n)\n\ndo_have_list = []\n\nfor order in note_have_transfer:\n    do_have_list.append(order.name)\n    frappe.db.set_value('Delivery Order', order.name, {\n        'tr_no': None,\n        'transfer_driver': None,\n        'transfer_driver_name': None,\n        'transfer_vehicle_no': None,\n        'transfer_date_time': None,\n        'transfer_target_warehouse': None,\n        'current_warehouse': doc.source_warehouse,\n        'transfer_status': 'Open'\n    })\n    \nerror_do = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    records = frappe.get_all(\"Delivery Order Transfer\",\n    fields=['name', 'transfer_status', 'source_warehouse', 'target_warehouse', 'driver', 'driver_name', 'vehicle', 'departure_date_time', 'target_warehouse'],\n    filters=[\n            [\"Delivery Order Transfer Item\", \"delivery_order\", \"=\", do.name],\n            [\"docstatus\", \"!=\", 2]\n        ],\n    order_by='name desc',\n    page_length=1,\n    )\n    if len(records) > 0:\n        latest = records[0]\n        if latest.transfer_status == 'Completed':\n            frappe.db.set_value('Delivery Order', do.name, {\n                'transfer_status': 'Open',\n                'current_warehouse': latest.target_warehouse,\n                'tr_no': latest.name,\n                'transfer_driver': latest.driver,\n                'transfer_driver_name': latest.driver_name,\n                'transfer_vehicle_no': latest.vehicle,\n                'transfer_date_time': latest.departure_date_time,\n                'transfer_target_warehouse': latest.target_warehouse\n            })\n        else:\n            frappe.db.set_value('Delivery Order', do.name, {\n                'transfer_status': latest.transfer_status,\n                'current_warehouse': latest.source_warehouse,\n                'tr_no': latest.name,\n                'transfer_driver': latest.driver,\n                'transfer_driver_name': latest.driver_name,\n                'transfer_vehicle_no': latest.vehicle,\n                'transfer_date_time': latest.departure_date_time,\n                'transfer_target_warehouse': latest.target_warehouse\n            })\n    else:\n        frappe.db.set_value('Delivery Order', do.name, {\n        'tr_no': None,\n        'transfer_driver': None,\n        'transfer_driver_name': None,\n        'transfer_vehicle_no': None,\n        'transfer_date_time': None,\n        'transfer_target_warehouse': None,\n        'current_warehouse': do.source_warehouse,\n        'transfer_status': 'Open'\n    })\n    \n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save (Submitted Document)",
  "event_frequency": "All",
  "modified": "2023-09-14 13:14:10.770216",
  "module": null,
  "name": "delivery-order-trip-after-save-submit",
  "reference_doctype": "Delivery Order Trip",
  "script": "error_do_warehouse = []\nerror_do_not_open = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.current_warehouse != doc.source_warehouse:\n        error_do_warehouse.append(do.name)\n    if do.transfer_status != 'Open':\n        error_do_not_open.append(do.name)\n\nif len(error_do_warehouse) > 0:\n    frappe.throw('Delivery Order Is Not Currently In ' + doc.source_warehouse + ': ' + ','.join(error_do_warehouse))\nif len(error_do_not_open) > 0:\n    frappe.throw('Delivery Order Is Not Open For Dispatch: ' + ','.join(error_do_warehouse))\n\nnote_have_transfer = frappe.db.get_list('Delivery Order',\n    filters={\n        'dr_no': doc.name\n    },\n    fields= ['name']\n)\n\nfor order in note_have_transfer:\n    frappe.db.set_value('Delivery Order', order.name, {\n        'dr_no': None,\n        'dispatch_driver': None,\n        'dispatch_driver_name': None,\n        'dispatch_vehicle_no': None,\n        'dispatch_date_time': None\n    })\n\nfor item in doc.items:\n    frappe.db.set_value('Delivery Order', item.delivery_order, {\n        'dr_no': doc.name,\n        'dispatch_driver': doc.driver,\n        'dispatch_driver_name': doc.driver_name,\n        'dispatch_vehicle_no': doc.vehicle,\n        'dispatch_date_time': doc.departure_date_time\n    })\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "event_frequency": "All",
  "modified": "2023-09-14 13:11:07.471424",
  "module": null,
  "name": "delivery-order-transfer-after-save-",
  "reference_doctype": "Delivery Order Transfer",
  "script": "error_do_in = []\nerror_do_warehouse = []\nerror_do_trip = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.transfer_status != 'Open':\n        if do.tr_no != doc.name:\n            error_do_in.append(do.name)\n    if do.current_warehouse != doc.source_warehouse:\n        error_do_warehouse.append(do.name)\n    if do.dr_no != None:\n            error_do_trip.append(do.name)\n\nif len(error_do_in) > 0:\n    frappe.throw('Delivery Order Is '+ do.transfer_status + ': '  + ','.join(error_do_in))\nif len(error_do_warehouse) > 0:\n    frappe.throw('Delivery Order Is Not Currently In ' + doc.source_warehouse + ': ' + ','.join(error_do_warehouse))\nif len(error_do_trip) > 0:\n    frappe.throw('Delivery Order Is Already Dispatch: ' + ','.join(error_do_trip))\n            \nnote_have_transfer = frappe.db.get_list('Delivery Order',\n    filters={\n        'tr_no': doc.name\n    },\n    fields= ['name', 'tr_no'],\n    page_length=9999\n)\n\ndo_have_list = []\n\nfor order in note_have_transfer:\n    do_have_list.append(order.name)\n    frappe.db.set_value('Delivery Order', order.name, {\n        'tr_no': None,\n        'transfer_driver': None,\n        'transfer_driver_name': None,\n        'transfer_vehicle_no': None,\n        'transfer_date_time': None,\n        'transfer_target_warehouse': None,\n        'current_warehouse': doc.source_warehouse,\n        'transfer_status': 'Open'\n    })\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    records = frappe.get_all(\"Delivery Order Transfer\",\n    fields=['name', 'transfer_status', 'source_warehouse', 'target_warehouse', 'driver', 'driver_name', 'vehicle', 'departure_date_time', 'target_warehouse'],\n    filters=[\n            [\"Delivery Order Transfer Item\", \"delivery_order\", \"=\", do.name],\n            [\"docstatus\", \"!=\", 2]\n        ],\n    order_by='name desc',\n    page_length=1,\n    )\n    if len(records) > 0:\n        latest = records[0]\n        if latest.transfer_status == 'Completed':\n            frappe.db.set_value('Delivery Order', do.name, {\n                'transfer_status': 'Open',\n                'current_warehouse': latest.target_warehouse,\n                'tr_no': latest.name,\n                'transfer_driver': latest.driver,\n                'transfer_driver_name': latest.driver_name,\n                'transfer_vehicle_no': latest.vehicle,\n                'transfer_date_time': latest.departure_date_time,\n                'transfer_target_warehouse': latest.target_warehouse\n            })\n        else:\n            frappe.db.set_value('Delivery Order', do.name, {\n                'transfer_status': latest.transfer_status,\n                'current_warehouse': latest.source_warehouse,\n                'tr_no': latest.name,\n                'transfer_driver': latest.driver,\n                'transfer_driver_name': latest.driver_name,\n                'transfer_vehicle_no': latest.vehicle,\n                'transfer_date_time': latest.departure_date_time,\n                'transfer_target_warehouse': latest.target_warehouse\n            })\n    else:\n        frappe.db.set_value('Delivery Order', do.name, {\n        'tr_no': None,\n        'transfer_driver': None,\n        'transfer_driver_name': None,\n        'transfer_vehicle_no': None,\n        'transfer_date_time': None,\n        'transfer_target_warehouse': None,\n        'current_warehouse': do.source_warehouse,\n        'transfer_status': 'Open'\n    })\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "event_frequency": "All",
  "modified": "2023-09-14 13:14:49.729088",
  "module": null,
  "name": "delivery-order-trip-after-save-",
  "reference_doctype": "Delivery Order Trip",
  "script": "error_do_warehouse = []\nerror_do_not_open = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.current_warehouse != doc.source_warehouse:\n        error_do_warehouse.append(do.name)\n    if do.transfer_status != 'Open':\n        error_do_not_open.append(do.name)\n\nif len(error_do_warehouse) > 0:\n    frappe.throw('Delivery Order Is Not Currently In ' + doc.source_warehouse + ': ' + ','.join(error_do_warehouse))\nif len(error_do_not_open) > 0:\n    frappe.throw('Delivery Order Is Not Open For Dispatch: ' + ','.join(error_do_warehouse))\n\nnote_have_transfer = frappe.db.get_list('Delivery Order',\n    filters={\n        'dr_no': doc.name\n    },\n    fields= ['name']\n)\n\nfor order in note_have_transfer:\n    frappe.db.set_value('Delivery Order', order.name, {\n        'dr_no': None,\n        'dispatch_driver': None,\n        'dispatch_driver_name': None,\n        'dispatch_vehicle_no': None,\n        'dispatch_date_time': None\n    })\n\nfor item in doc.items:\n    frappe.db.set_value('Delivery Order', item.delivery_order, {\n        'dr_no': doc.name,\n        'dispatch_driver': doc.driver,\n        'dispatch_driver_name': doc.driver_name,\n        'dispatch_vehicle_no': doc.vehicle,\n        'dispatch_date_time': doc.departure_date_time\n    })\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Delete",
  "event_frequency": "All",
  "modified": "2023-09-13 04:15:35.294810",
  "module": null,
  "name": "delivery-order-trip-after-delete",
  "reference_doctype": "Delivery Order Trip",
  "script": "note_have_transfer = frappe.db.get_list('Delivery Order',\n    filters={\n        'dr_no': doc.name\n    },\n    fields= ['name']\n)\n\nfor order in note_have_transfer:\n    frappe.db.set_value('Delivery Order', order.name, {\n        'dr_no': None,\n        'dispatch_driver': None,\n        'dispatch_driver_name': None,\n        'dispatch_vehicle_no': None,\n        'dispatch_date_time': None\n    })",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-06-14 09:13:05.305916",
  "module": null,
  "name": "tms-recipient-before-insert",
  "reference_doctype": "TMS Recipient",
  "script": "if \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\" in doc.state:\n    city_prefix = '\u0e41\u0e02\u0e27\u0e07'\n    county_prefix = '\u0e40\u0e02\u0e15'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\u0e2f \") if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode\nelse:\n    city_prefix = '\u0e15\u0e33\u0e1a\u0e25'\n    county_prefix = '\u0e2d\u0e33\u0e40\u0e20\u0e2d'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + doc.state + ' ') if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2023-06-20 08:15:40.068945",
  "module": null,
  "name": "tms-recipient-before-save",
  "reference_doctype": "TMS Recipient",
  "script": "# if frappe.db.exists({\"doctype\": \"TMS Recipient\", \"address_title\": doc.address_title, \"company\": doc.company}):\n#     list = frappe.db.get_list('TMS Recipient',\n#     filters={\n#         \"address_title\": doc.address_title, \n#         \"company\": doc.company\n#     },\n#     fields=['name'],\n#     order_by='creation desc',\n#     )\n#     if list[0].name not in doc.name:\n#         frappe.throw(f\"{doc.address_title} is already in {doc.company}'s Recipient\")\n\nif \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\" in doc.state:\n    city_prefix = '\u0e41\u0e02\u0e27\u0e07'\n    county_prefix = '\u0e40\u0e02\u0e15'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\u0e2f \") if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode\nelse:\n    city_prefix = '\u0e15\u0e33\u0e1a\u0e25'\n    county_prefix = '\u0e2d\u0e33\u0e40\u0e20\u0e2d'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + doc.state + ' ') if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2023-07-02 13:55:42.174592",
  "module": null,
  "name": "tax-customer-in-line-address-before-save",
  "reference_doctype": "Tax Customer",
  "script": "# if frappe.db.exists({\"doctype\": \"TMS Customer\", \"address_title\": doc.address_title, \"company\": doc.company}):\n#     list = frappe.db.get_list('TMS Customer',\n#     filters={\n#         \"address_title\": doc.address_title, \n#         \"company\": doc.company\n#     },\n#     fields=['name'],\n#     order_by='creation desc',\n#     )\n#     if list[0].name not in doc.name:\n#         frappe.throw(f\"{doc.address_title} is already in {doc.company}'s Sender\")\n\nif \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\" in doc.state:\n    city_prefix = '\u0e41\u0e02\u0e27\u0e07'\n    county_prefix = '\u0e40\u0e02\u0e15'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\u0e2f \") if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode\nelse:\n    city_prefix = '\u0e15\u0e33\u0e1a\u0e25'\n    county_prefix = '\u0e2d\u0e33\u0e40\u0e20\u0e2d'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + doc.state + ' ') if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-07-02 13:56:04.264756",
  "module": null,
  "name": "tax-customer-in-line-address",
  "reference_doctype": "Tax Customer",
  "script": "if \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\" in doc.state:\n    city_prefix = '\u0e41\u0e02\u0e27\u0e07'\n    county_prefix = '\u0e40\u0e02\u0e15'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + \"\u0e01\u0e23\u0e38\u0e07\u0e40\u0e17\u0e1e\u0e2f \") if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode\nelse:\n    city_prefix = '\u0e15\u0e33\u0e1a\u0e25'\n    county_prefix = '\u0e2d\u0e33\u0e40\u0e20\u0e2d'\n    state_prefix = '\u0e08\u0e31\u0e07\u0e2b\u0e27\u0e31\u0e14'\n    city = str(city_prefix + doc.city + \" \") if doc.city is not None else \" \"\n    county = str(county_prefix + doc.county + \" \") if doc.county is not None else \" \"\n    state = str(state_prefix + doc.state + ' ') if doc.state is not None else \" \"\n    pincode = doc.pincode if doc.pincode is not None else \" \"\n    phone = doc.phone if doc.phone is not None else \" \"\n    doc.in_line_address = doc.address_line1 + \" \" + city + county + state + pincode",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Submit",
  "event_frequency": "All",
  "modified": "2023-08-16 19:41:30.310204",
  "module": null,
  "name": "vehicle-log-afet-submit",
  "reference_doctype": "Vehicle Log",
  "script": "doc.average_fuel_consumtion = (float(doc.odometer) - float(doc.last_odometer)) / float(doc.fuel_qty)",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "update-delivery-order-warehouse",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-09-12 00:38:43.565489",
  "module": null,
  "name": "update-delivery-order-warehouse",
  "reference_doctype": "Delivery Order Transfer",
  "script": "items = json.loads(frappe.form_dict.get('items'))\nnew_warehouse = frappe.form_dict.get('new_warehouse')\n\nfor item in items:\n    frappe.db.set_value('Delivery Order', item.get('name'), {\n        \"current_warehouse\": new_warehouse,\n    })",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-09-14 13:10:19.994161",
  "module": null,
  "name": "delivery-order-transfer-after-insert",
  "reference_doctype": "Delivery Order Transfer",
  "script": "doc.transfer_status = 'Loaded'\n\nerror_do_in = []\nerror_do_warehouse = []\nerror_do_trip = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.transfer_status != 'Open':\n        if do.tr_no != doc.name:\n            error_do_in.append(do.name)\n    if do.current_warehouse != doc.source_warehouse:\n        error_do_warehouse.append(do.name)\n    if do.dr_no != None:\n            error_do_trip.append(do.name)\n\nif len(error_do_in) > 0:\n    frappe.throw('Delivery Order Is '+ do.transfer_status + ': '  + ','.join(error_do_in))\nif len(error_do_warehouse) > 0:\n    frappe.throw('Delivery Order Is Not Currently In ' + doc.source_warehouse + ': ' + ','.join(error_do_warehouse))\nif len(error_do_trip) > 0:\n    frappe.throw('Delivery Order Is Already Dispatch: ' + ','.join(error_do_trip))",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Delete",
  "event_frequency": "All",
  "modified": "2023-09-12 17:25:18.660260",
  "module": null,
  "name": "delivery-order-transfer-after-delete",
  "reference_doctype": "Delivery Order Transfer",
  "script": "note_have_transfer = frappe.db.get_list('Delivery Order',\n    filters={\n        'tr_no': doc.name\n    },\n    fields= ['name', 'tr_no'],\n    page_length=9999\n)\n\ndo_have_list = []\n\nfor order in note_have_transfer:\n    do_have_list.append(order.name)\n    frappe.db.set_value('Delivery Order', order.name, {\n        'tr_no': None,\n        'transfer_driver': None,\n        'transfer_driver_name': None,\n        'transfer_vehicle_no': None,\n        'transfer_date_time': None,\n        'transfer_target_warehouse': None,\n        'current_warehouse': doc.source_warehouse,\n        'transfer_status': 'Open'\n    })\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    records = frappe.get_all(\"Delivery Order Transfer\",\n    fields=['name', 'transfer_status', 'source_warehouse', 'target_warehouse', 'driver', 'driver_name', 'vehicle', 'departure_date_time', 'target_warehouse'],\n    filters=[\n            [\"Delivery Order Transfer Item\", \"delivery_order\", \"=\", do.name],\n            [\"docstatus\", \"!=\", 2]\n        ],\n    order_by='name desc',\n    page_length=1,\n    )\n    if len(records) > 0:\n        latest = records[0]\n        if latest.transfer_status == 'Completed':\n            frappe.db.set_value('Delivery Order', do.name, {\n                'transfer_status': 'Open',\n                'current_warehouse': latest.target_warehouse\n            })\n        else:\n            frappe.db.set_value('Delivery Order', do.name, {\n                'transfer_status': latest.transfer_status,\n                'current_warehouse': latest.source_warehouse,\n                'tr_no': latest.name,\n                'transfer_driver': latest.driver,\n                'transfer_driver_name': latest.driver_name,\n                'transfer_vehicle_no': latest.vehicle,\n                'transfer_date_time': latest.departure_date_time,\n                'transfer_target_warehouse': latest.target_warehouse\n            })\n    else:\n        frappe.db.set_value('Delivery Order', do.name, {\n        'tr_no': None,\n        'transfer_driver': None,\n        'transfer_driver_name': None,\n        'transfer_vehicle_no': None,\n        'transfer_date_time': None,\n        'transfer_target_warehouse': None,\n        'current_warehouse': do.source_warehouse,\n        'transfer_status': 'Open'\n    })\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "event_frequency": "All",
  "modified": "2023-09-14 13:15:51.485374",
  "module": null,
  "name": "delivery-order-trip-after-insert",
  "reference_doctype": "Delivery Order Trip",
  "script": "error_do_warehouse = []\nerror_do_not_open = []\n\nfor item in doc.items:\n    do = frappe.get_doc('Delivery Order', item.delivery_order)\n    if do.current_warehouse != doc.source_warehouse:\n        error_do_warehouse.append(do.name)\n    if do.transfer_status != 'Open':\n        error_do_not_open.append(do.name)\n\nif len(error_do_warehouse) > 0:\n    frappe.throw('Delivery Order Is Not Currently In ' + doc.source_warehouse + ': ' + ','.join(error_do_warehouse))\nif len(error_do_not_open) > 0:\n    frappe.throw('Delivery Order Is Not Open For Dispatch: ' + ','.join(error_do_warehouse))",
  "script_type": "DocType Event"
 }
]